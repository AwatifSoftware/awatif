{
  "version": 3,
  "sources": ["../../awatif-ui/node_modules/vanjs-core/src/van.js"],
  "sourcesContent": ["// This file consistently uses `let` keyword instead of `const` for reducing the bundle size.\n\n// Global variables - aliasing some builtin symbols to reduce the bundle size.\nlet protoOf = Object.getPrototypeOf\nlet changedStates, curDeps, curNewDerives, alwaysConnectedDom = {isConnected: 1}, gcCycleInMs = 1000, statesToGc, propSetterCache = {}\nlet objProto = protoOf(alwaysConnectedDom), funcProto = protoOf(protoOf)\n\nlet addAndScheduleOnFirst = (set, s, f, waitMs) =>\n  (set ?? (setTimeout(f, waitMs), new Set)).add(s)\n\nlet runAndCaptureDeps = (f, deps, arg) => {\n  let prevDeps = curDeps\n  curDeps = deps\n  try {\n    return f(arg)\n  } catch (e) {\n    console.error(e)\n    return arg\n  } finally {\n    curDeps = prevDeps\n  }\n}\n\nlet keepConnected = l => l.filter(b => b._dom?.isConnected)\n\nlet addStatesToGc = d => statesToGc = addAndScheduleOnFirst(statesToGc, d, () => {\n  for (let s of statesToGc)\n    s._bindings = keepConnected(s._bindings),\n    s._listeners = keepConnected(s._listeners)\n  statesToGc = null\n}, gcCycleInMs)\n\nlet stateProto = {\n  get val() {\n    curDeps?._getters?.add(this)\n    return this._val\n  },\n\n  get oldVal() {\n    curDeps?._getters?.add(this)\n    return this._oldVal\n  },\n\n  set val(v) {\n    curDeps?._setters?.add(this)\n    if (v !== this._val) {\n      this._val = v\n      let listeners = [...this._listeners = keepConnected(this._listeners)]\n      for (let l of listeners) derive(l.f, l.s, l._dom), l._dom = null\n      this._bindings.length ?\n        changedStates = addAndScheduleOnFirst(changedStates, this, updateDoms) :\n        this._oldVal = v\n    }\n  },\n}\n\nlet state = initVal => ({\n  __proto__: stateProto,\n  _val: initVal,\n  _oldVal: initVal,\n  _bindings: [],\n  _listeners: [],\n})\n\nlet bind = (f, dom) => {\n  let deps = {_getters: new Set, _setters: new Set}, binding = {f}, prevNewDerives = curNewDerives\n  curNewDerives = []\n  let newDom = runAndCaptureDeps(f, deps, dom)\n  newDom = (newDom ?? document).nodeType ? newDom : new Text(newDom)\n  for (let d of deps._getters)\n    deps._setters.has(d) || (addStatesToGc(d), d._bindings.push(binding))\n  for (let l of curNewDerives) l._dom = newDom\n  curNewDerives = prevNewDerives\n  return binding._dom = newDom\n}\n\nlet derive = (f, s = state(), dom) => {\n  let deps = {_getters: new Set, _setters: new Set}, listener = {f, s}\n  listener._dom = dom ?? curNewDerives?.push(listener) ?? alwaysConnectedDom\n  s.val = runAndCaptureDeps(f, deps, s._val)\n  for (let d of deps._getters)\n    deps._setters.has(d) || (addStatesToGc(d), d._listeners.push(listener))\n  return s\n}\n\nlet add = (dom, ...children) => {\n  for (let c of children.flat(Infinity)) {\n    let protoOfC = protoOf(c ?? 0)\n    let child = protoOfC === stateProto ? bind(() => c.val) :\n      protoOfC === funcProto ? bind(c) : c\n    child != null && dom.append(child)\n  }\n  return dom\n}\n\nlet tag = (ns, name, ...args) => {\n  let [props, ...children] = protoOf(args[0] ?? 0) === objProto ? args : [{}, ...args]\n  let dom = ns ? document.createElementNS(ns, name) : document.createElement(name)\n  for (let [k, v] of Object.entries(props)) {\n    let getPropDescriptor = proto => proto ?\n      Object.getOwnPropertyDescriptor(proto, k) ?? getPropDescriptor(protoOf(proto)) :\n      null\n    let cacheKey = name + \",\" + k\n    let propSetter = propSetterCache[cacheKey] ??\n      (propSetterCache[cacheKey] = getPropDescriptor(protoOf(dom))?.set ?? 0)\n    let setter = k.startsWith(\"on\") ?\n      (v, oldV) => {\n        let event = k.slice(2)\n        dom.removeEventListener(event, oldV)\n        dom.addEventListener(event, v)\n      } :\n      propSetter ? propSetter.bind(dom) : dom.setAttribute.bind(dom, k)\n    let protoOfV = protoOf(v ?? 0)\n    k.startsWith(\"on\") || protoOfV === funcProto && (v = derive(v), protoOfV = stateProto)\n    protoOfV === stateProto ? bind(() => (setter(v.val, v._oldVal), dom)) : setter(v)\n  }\n  return add(dom, ...children)\n}\n\nlet handler = ns => ({get: (_, name) => tag.bind(null, ns, name)})\nlet tags = new Proxy(ns => new Proxy(tag, handler(ns)), handler())\n\nlet update = (dom, newDom) => newDom ? newDom !== dom && dom.replaceWith(newDom) : dom.remove()\n\nlet updateDoms = () => {\n  let changedStatesArray = [...changedStates].filter(s => s._val !== s._oldVal)\n  changedStates = null\n  for (let b of new Set(changedStatesArray.flatMap(s => s._bindings = keepConnected(s._bindings))))\n    update(b._dom, bind(b.f, b._dom)), b._dom = null\n  for (let s of changedStatesArray) s._oldVal = s._val\n}\n\nlet hydrate = (dom, f) => update(dom, bind(f, dom))\n\nexport default {add, tags, state, derive, hydrate}\n"],
  "mappings": "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",
  "names": ["v"]
}
